diff -u atop-1.23/acctproc.c atop-1.23/acctproc.c
--- atop-1.23/acctproc.c
+++ atop-1.23/acctproc.c
@@ -126,7 +126,7 @@
 #include "photoproc.h"
 #include "acctproc.h"
 
-#define	ACCTDIR		"/tmp/atop.d"
+#define	ACCTDIR		"/var/run/atop"
 #define	ACCTFILE	"atop.acct"
 #define	ACCTENV		"ATOPACCT"
 
@@ -331,7 +331,7 @@
 	if (semctl(semid, 1, GETVAL, 0) == SEMTOTAL)
 	{
 		/*
-		** create a new separate directory below /tmp
+		** create a new separate directory below /var/run
 		** for the accounting file;
 		** if this directory exists (e.g. previous atop-run killed)
 		** it will be cleaned and newly created
diff -u atop-1.23/debian/changelog atop-1.23/debian/changelog
--- atop-1.23/debian/changelog
+++ atop-1.23/debian/changelog
@@ -1,3 +1,14 @@
+atop (1.23-1ubuntu1) maverick-security; urgency=low
+
+  * SECURITY UPDATE: vulnerable to symlink attack via insecure /tmp directory 
+    or file (LP: #820497)
+    - modify acctproc.c to use "/var/run/atop" and rawread.c
+      to use mkstemp. Based on upstream patch.
+    - http://bugs.debian.org/cgi-bin/bugreport.cgi?msg=24;filename=nmudiff.atop;att=1;bug=622794
+    - CVE-2011-3618
+
+ -- Zubin Mithra <zubin.mithra@gmail.com>  Thu, 09 Feb 2012 14:00:51 +0530
+
 atop (1.23-1) unstable; urgency=low
 
   * fixed typo (Closes: #467447)
diff -u atop-1.23/debian/control atop-1.23/debian/control
--- atop-1.23/debian/control
+++ atop-1.23/debian/control
@@ -1,7 +1,8 @@
 Source: atop
 Section: admin
 Priority: optional
-Maintainer: Edelhard Becker <edelhard@debian.org>
+Maintainer: Ubuntu Developers <ubuntu-devel-discuss@lists.ubuntu.com>
+XSBC-Original-Maintainer: Edelhard Becker <edelhard@debian.org>
 Build-Depends: debhelper (>= 4), zlib1g-dev, libncurses5-dev
 Standards-Version: 3.7.3
 Homepage: http://www.atconsultancy.nl/atop/home.html
diff -u atop-1.23/rawlog.c atop-1.23/rawlog.c
--- atop-1.23/rawlog.c
+++ atop-1.23/rawlog.c
@@ -477,18 +477,18 @@
 		*/
 		fprintf(stderr, "Decompressing logfile ....\n");
 
-		snprintf(tmpname2, sizeof tmpname2, "/tmp/atopwrk%d", getpid());
-		snprintf(command,  sizeof command, "gunzip -c %s > %s",
-							tmpname1, tmpname2);
-		system (command);
+		snprintf(tmpname2, sizeof tmpname2, "/tmp/atopwrkXXXXXX");
 
-		if ( (rawfd = open(tmpname2, O_RDONLY)) == -1)
+		if ( (rawfd = mkstemp(tmpname2)) == -1)
 		{
 			fprintf(stderr, "%s - ", rawname);
 			perror("open decompressed raw file");
 			cleanstop(7);
 		}
 
+		snprintf(command, sizeof command, "gunzip -c %s > %s",
+						tmpname1, tmpname2);
+		system(command);
 		unlink(tmpname2);
 	}
 
